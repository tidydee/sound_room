
<script src="http://connect.soundcloud.com/sdk.js"></script>
<script>
  SC.initialize({
    client_id: '173c1924dc4e55b0db3b89a45bb71561'
  });

  function getUserFavoriteTracks() {
    var soundcloud_id =  <%= current_user.soundcloud_user_id %>
    SC.get('/users/'+soundcloud_id+'/favorites', function(favorites) {
      var dataArray = [];
      for (var i=0; i<favorites.length; i++) {
        var trackTitle = favorites[i].title;
        var trackId = favorites[i].id;
        var trackStreamUrl = favorites[i].stream_url;
        var trackOrder = i;

        dataArray.push( trackId );

        $('#favorite_tracks').append("<tr><td class='track'>"+trackTitle+"</td><td><a href='' class='button tiny' id='"+i+"'' data-track-id="+trackId+" data-track-order="+i+">Add</a></td></tr>")
      }

      // console.log('TrackIDs:' +dataArray);      
      // console.log('TrackID:' +trackId);
      // console.log('TrackTitle:' +trackTitle);


      $('.button').on('click', function(){
        var scTrackId = $(this).data('track-id');
        // console.log(scTrackId);
        saveToDb(scTrackId);
      });
      
        function saveToDb(scTrackId){
          console.log(scTrackId);
          $.ajax({
          url: "<%= songs_path %>",
          data: {  soundcloud_track_id: scTrackId },
          type: "POST",
          success: function(){
            alert("shit got saved");
          },
          error: function (err) {
            console.log(err);
          }
        });
      }
    
      
      

          
      $('.track').click(function(e) {
        console.log('this click?');
        playTrack($(this).data('track-id'));
      }); 
    });
  };
    
  getUserFavoriteTracks();


</script>

<div class="row" data-room-id="<%= @room.id %>">
  <div class="large-9 column">
    <h1> <%= @room.name %> </h1>
    <span style="color:white;"> <%= request.original_url %> </span>
      <!-- Only a User who created a room, can Delete a Room -->
    <% if current_user %>
      <% if @room.user_id == session[:user_id] %>
        <%= @room.name %> <%= link_to "delete", room_path(@room), method: :delete, data: {confirm: "You sure?"} %>
      <% end %>
    <% end %>
    <!-- Tracks from SoundCloud -->
    

    <table>
      <thead>
        <tr>
          <th width="200">Tracks from Soundcloud</th>
          <th></th>
        </tr>
      </thead>
      <tbody id="favorite_tracks" >
      

        <!-- My SC Song streams in here -->
      </tbody>

    </table>

  <div >
    <h4>Create New Song</h4>
    <%= form_for @song do |f| %>
      <%= f.label :title %>
      <%= f.label :room_id %>
      <%= f.text_field :title %><br />
      <%= f.submit%>
    <% end %>
  </div> 






  </div> <!--large9 column-->

  <div class="large-3 columns chat-wrap">
    <%= render partial: "/rooms/chatbar" %>
  </div>

  <div class="large-3">
    <% if current_user %>
      <h4>Room's Playlist</h4>
      <p>Add a new song to the playlist</p>
      <a href="#" data-reveal-id="myModal">+ songs</a>
        <div id="myModal" class="reveal-modal" data-reveal>
          <%= render partial: "/rooms/addtoplaylist" %>
          <% @songs.each do |song| %>
            <%= song.url %><br />
          <% end %>
    <% else %> 
      <div class="large-8 column">
        <div data-alert class="alert-box alert">
          <p>Please sign in to add to the playlist.</p>
          <a href="#" class="close">&times;</a>
        </div>
      </div>  
    <% end %>
    </div>
  </div><br />

  <div class="row player-wrap">
    <h3>Player goes here</h3>
  </div>
</div>


 <!--  <div style=" border: solid 2px; height:100px; width:350px; overflow:scroll;"> -->









